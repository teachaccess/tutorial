import { EditorView, basicSetup } from "@codemirror/basic-setup";
import { EditorState, Compartment } from "@codemirror/state";
import { htmlLanguage, html } from "@codemirror/lang-html";
import { language } from "@codemirror/language";
import { javascript } from "@codemirror/lang-javascript";
import { Helmet } from "react-helmet";
import parse from "html-react-parser";
const languageConf = new Compartment();

export const Editor = ({
  initialHtml = '<div class="A fake heading">A fake heading</div>',
}) => {
  const [view, setView] = React.useState();
  const [output, setOutput] = React.useState(initialHtml);
  React.useEffect(() => {
    const editorView = new EditorView({
      state: EditorState.create({
        doc: '<div class="A fake heading">A fake heading</div>',
        extensions: [
          basicSetup,
          html(),
          EditorView.updateListener.of((v) => {
            if (v.docChanged) {
              setOutput(v.state.doc.toString());
            }
          }),
        ],
      }),
      parent: document.querySelector("#editor"),
    });
    setView(editorView);
  }, []);
  return (
    <div>
      <div id="editor"></div>
      <div id="html-output">{parse(output)}</div>
    </div>
  );
};
