import { EditorView, basicSetup } from "@codemirror/basic-setup";
import { EditorState } from "@codemirror/state";
import { html } from "@codemirror/lang-html";
import parse from "html-react-parser";

export const Editor = ({
  initialHtml = '<div class="A fake heading">A fake heading</div>',
}) => {
  const [view, setView] = React.useState();
  const [output, setOutput] = React.useState(initialHtml);
  React.useEffect(() => {
    const editorView = new EditorView({
      state: EditorState.create({
        doc: '<div class="A fake heading">A fake heading</div>',
        extensions: [
          basicSetup,
          html(),
          EditorView.updateListener.of((v) => {
            if (v.docChanged) {
              setOutput(v.state.doc.toString());
            }
          }),
        ],
      }),
      parent: document.querySelector("#editor"),
    });
    setView(editorView);
  }, []);
  return (
    <div className="editor-container">
      <div>
        <div className="playground-header">Live editor</div>
        <div
          id="editor"
          className="npm__react-simple-code-editor__textarea"
        ></div>
      </div>
      <div className="playground-header">Result</div>
      <div className="html-output">{parse(output)}</div>
    </div>
  );
};
